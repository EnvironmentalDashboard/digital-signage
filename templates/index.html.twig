{% extends "base.html.twig" %}

{% block title %}{{ parent() }}{% endblock %}

{% block head %}
{{ parent() }}
{# <meta name="description" content=""> #}
{% endblock %}

{% block javascript %}
{{ parent() }}
<script>
  // Submit event to fire when forms are submitted
  var submitEvent = function(e) {
    e.preventDefault();

    // Update carousel list & modals
    $.post($(this).attr('action'), $(this).serialize()).done(function() {
      $.ajax({
          url: "{{ path("carousel-list-all") }}",
          type: "GET",
          success: function(data) {
            $("#nav-all-carousels").html(data);

            // Re-apply submit event to new forms
            $('form[method=POST]').on('submit', submitEvent);
          }
      });
    });
  };

  // Apply submit event to all forms
  $('form[method=POST]').on('submit', submitEvent);

  // Add new frame
  $(".carousel-add-new-frame").each(function(){
    $(this).on('click', function(e) {
      var carousel = $(this).data('carousel-for');

      $("#carousel-" + carousel + "-frame-edit").append("New frame...");
    });
  });



  var num_new_entities = {
    'pres': 0,
    'buttons': 0
  };
  $('#save-pres').on('click', function (e) {
    e.preventDefault();
    add_entity('pres', $(this), $('#pres-list'), $('#create-display-form'));
  });
  $('#save-button').on('click', function (e) {
    e.preventDefault();
    add_entity('buttons', $(this), $('#button-list'), $('#create-controller-form'));
  });

  function add_entity(entity_name, submit_btn, display_list, real_form) {
    var form = submit_btn.closest('form');
    var data = form.serializeArray();
    real_form.append("<input type='hidden' name='" + entity_name + num_new_entities[entity_name] + "' value='" + form.serialize() +
      "' />");
    var li = "<li class='list-group-item'>";
    for (var i = 0; i < data.length; i++) {
      if (i === 0) {
        li += data[i].value;
      } else {
        li += ' - ' + data[i].value;
      }
    }
    display_list.append(li + "</li>");
    form.find('input[type!=hidden]').val('');
    num_new_entities[entity_name]++;
    submit_btn.closest('.modal').modal('hide');
  }
</script>
{% endblock %}


{% block body %}
<!-- modal -->
<div class="modal fade" id="createButtonModal" tabindex="-1" role="dialog" aria-labelledby="createButtonModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form>
        <div class="modal-header">
          <h5 class="modal-title" id="createButtonModalLabel">Add Button</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="on_display">Which display?</label>
            <select class="form-control" id="on_display" name="on_display">
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
            </select>
          </div>
          <div class="form-group">
            <label for="trigger_frame">Which frame?</label>
            <select class="form-control" id="trigger_frame" name="trigger_frame">
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
            </select>
          </div>
          <div class="form-group">
            <label for="button_twig_key">Button placement</label>
            <select class="form-control" id="button_twig_key" name="button_twig_key">
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="save-button">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- modal -->
<div class="modal fade" id="createPresModal" tabindex="-1" role="dialog" aria-labelledby="createPresModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <form>
        <div class="modal-header">
          <h5 class="modal-title" id="createPresModalLabel">Add Presentation</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="pres_template_id">Select template</label>
            <select class="form-control" id="pres_template_id" name="pres_template_id">
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
            </select>
          </div>
          <div class="form-group">
            <p>Drag carousels onto template:</p>
            <div class="row">
              <div class="col-sm-6">
                <div style="height: 300px;width: 100%;background: slategray;"></div>
              </div>
              <div class="col-sm-6">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">Carousel 1</li>
                  <li class="list-group-item">Carousel 2</li>
                  <li class="list-group-item">Carousel 3</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="create_pres_duration">Duration</label>
            <input type="number" class="form-control" id="create_pres_duration" aria-describedby="pres_duration_help"
              name="create_pres_duration">
            <small id="pres_duration_help" class="form-text text-muted">In seconds</small>
          </div>
          <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="skip" name="skip">
            <label class="form-check-label" for="skip">Skip in main loop</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="save-pres">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>


<div class="container">
  <img src="https://environmentaldashboard.org/prefs/images/env_logo.png" alt="" class="img-fluid">
  <div style="height:50px;clear:both;"></div>
  <div class="row">
    <div class="col-3">
      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
        <a class="nav-link active" id="v-pills-display-tab" data-toggle="pill" href="#v-pills-displays" role="tab"
          aria-controls="v-pills-displays" aria-selected="true">Displays</a>
        <a class="nav-link" id="v-pills-carousels-tab" data-toggle="pill" href="#v-pills-carousels" role="tab"
          aria-controls="v-pills-carousels" aria-selected="false">Carousels</a>
        <a class="nav-link" id="v-pills-remote-controllers-tab" data-toggle="pill" href="#v-pills-settings" role="tab"
          aria-controls="v-pills-settings" aria-selected="false">Remote Controllers</a>
      </div>
    </div>
    <div class="col-9">
      <div class="tab-content" id="v-pills-tabContent">
        <div class="tab-pane fade show active" id="v-pills-displays" role="tabpanel" aria-labelledby="v-pills-display-tab">
          <p class="text-muted text-center">You have no configured displays or carousels. Please create a carousel
            before creating a display.</p>
          <nav>
            <div class="nav nav-tabs justify-content-end" id="nav-tab" role="tablist">
              <a class="nav-item nav-link active" id="nav-all-displays-tab" data-toggle="tab" href="#nav-all-displays"
                role="tab" aria-controls="nav-all-displays" aria-selected="true">View all</a>
              <a class="nav-item nav-link" id="nav-create-display-tab" data-toggle="tab" href="#nav-create-display"
                role="tab" aria-controls="nav-create-display" aria-selected="false">Create new</a>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-all-displays" role="tabpanel" aria-labelledby="nav-all-displays-tab">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col" style="border-top:none">#</th>
                    <th scope="col" style="border-top:none">Label</th>
                    <th scope="col" style="border-top:none">Presentations</th>
                    <th scope="col" style="border-top:none">Total carousels</th>
                    <th scope="col" style="border-top:none">&nbsp;</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Carousel a</td>
                    <td>4</td>
                    <td>9</td>
                    <td>
                      <button class="btn btn-primary">Edit</button>
                      <button class="btn btn-danger">Delete</button>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Carousel b</td>
                    <td>2</td>
                    <td>4</td>
                    <td>
                      <button class="btn btn-primary">Edit</button>
                      <button class="btn btn-danger">Delete</button>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Carousel c</td>
                    <td>5</td>
                    <td>6</td>
                    <td>
                      <button class="btn btn-primary">Edit</button>
                      <button class="btn btn-danger">Delete</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="tab-pane fade" id="nav-create-display" role="tabpanel" aria-labelledby="nav-create-display-tab">
              <form id="create-display-form" action="" method="POST" class="mt-3" data-action="create-display">
                <div class="form-group row">
                  <label for="display-label" class="col-sm-2 col-form-label">Label</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="display-label" name="display-label" placeholder="Label">
                  </div>
                </div>
                <div class="form-group row">
                  <p class="col-sm-2 col-form-label">Presentations</p>
                  <div class="col-sm-10">
                    <ul class="list-group list-group-flush" id="pres-list">
                    </ul>
                    <button type="button" class="btn btn-light mt-2 btn-sm" data-toggle="modal" data-target="#createPresModal">Add
                      presentation</button>
                  </div>
                </div>
                <div class="form-group row">
                  <div class="col-sm-10">
                    <button type="submit" class="btn btn-primary">Create display</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="v-pills-carousels" role="tabpanel" aria-labelledby="v-pills-carousels-tab">
          <p class="text-muted text-center">You have no configured carousels.</p>
          <nav>
            <div class="nav nav-tabs justify-content-end" id="nav-tab" role="tablist">
              <a class="nav-item nav-link active" id="nav-all-carousels-tab" data-toggle="tab" href="#nav-all-carousels"
                role="tab" aria-controls="nav-all-carousels" aria-selected="true">View all</a>
              <a class="nav-item nav-link" id="nav-create-carousel-tab" data-toggle="tab" href="#nav-create-carousel"
                role="tab" aria-controls="nav-create-carousel" aria-selected="false">Create new</a>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-all-carousels" role="tabpanel" aria-labelledby="nav-all-carousels-tab">
              
            {{ render(controller('App\\Controller\\Carousel::listAll')) }}

            </div>
            <div class="tab-pane fade" id="nav-create-carousel" role="tabpanel" aria-labelledby="nav-create-carousel-tab">
              <form id="create-carousel-form" action="{{ path('carousel-create') }}" method="POST" class="mt-3">
                <div class="form-group row">
                  <label for="carousel-label" class="col-sm-2 col-form-label">Label</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="carousel-label" name="label" placeholder="Label">
                  </div>
                </div>
                <div class="form-group row">
                  <div class="col-sm-10">
                    <button type="submit" class="btn btn-primary">Create carousel</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-remote-controllers-tab">
          <p class="text-muted text-center">You have no configured remote controllers.</p>
          <nav>
            <div class="nav nav-tabs justify-content-end" id="nav-tab" role="tablist">
              <a class="nav-item nav-link active" id="nav-all-controllers-tab" data-toggle="tab" href="#nav-all-controllers"
                role="tab" aria-controls="nav-all-controllers" aria-selected="true">View all</a>
              <a class="nav-item nav-link" id="nav-create-controller-tab" data-toggle="tab" href="#nav-create-controller"
                role="tab" aria-controls="nav-create-controller" aria-selected="false">Create new</a>
            </div>
          </nav>
          <div class="tab-content">
            <div class="tab-pane fade show active" id="nav-all-controllers" role="tabpanel" aria-labelledby="nav-all-controllers-tab">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col" style="border-top:none">#</th>
                    <th scope="col" style="border-top:none">Label</th>
                    <th scope="col" style="border-top:none">Buttons</th>
                    <th scope="col" style="border-top:none">&nbsp;</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Remote controller a</td>
                    <td>4</td>
                    <td>
                      <button class="btn btn-primary">Edit</button>
                      <button class="btn btn-danger">Delete</button>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Remote controller b</td>
                    <td>4</td>
                    <td>
                      <button class="btn btn-primary">Edit</button>
                      <button class="btn btn-danger">Delete</button>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Remote controller c</td>
                    <td>4</td>
                    <td>
                      <button class="btn btn-primary">Edit</button>
                      <button class="btn btn-danger">Delete</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="tab-pane fade show" id="nav-create-controller" role="tabpanel" aria-labelledby="nav-create-controller-tab">
              <form id="create-controller-form" action="" method="POST" class="mt-3" data-action="create-controller">
                <div class="form-group row">
                  <label for="controller-label" class="col-sm-2 col-form-label">Label</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control" id="controller-label" name="controller-label" placeholder="Label">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="controller-label" class="col-sm-2 col-form-label">Controller template</label>
                  <div class="col-sm-10">
                    <select class="form-control" id="controller-label" name="controller-template">
                      <option>1</option>
                      <option>2</option>
                      <option>3</option>
                      <option>4</option>
                      <option>5</option>
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <p class="col-sm-2 col-form-label">Buttons</p>
                  <div class="col-sm-10">
                    <ul class="list-group list-group-flush" id="button-list">
                    </ul>
                    <button type="button" class="btn btn-light mt-2 btn-sm" data-toggle="modal" data-target="#createButtonModal">Add
                      button</button>
                  </div>
                </div>
                <div class="form-group row">
                  <div class="col-sm-10">
                    <button type="submit" class="btn btn-primary">Create remote controller</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}